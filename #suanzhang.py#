œóòß# -*- coding: utf-8 -*-
# ’Ù²”°ß’»»‘ÕË
# ’Ãæ’¹ñ‘Óé‘ÀÖ’Ô¡‘×¤‘Â×’ÆØ‘°ì’»ö‘´¦
# Version 3.1
# Copyright © 2018 ’èñ’½Õ’àñ. All rights reserved.

import csv
import time

# Initialise global variables

options = '1.”ºÇ’ºÓ’¿Ã 2.’×Å’Ğ²’Úç 3.‘ÕÔ’Ëô’Äî 4.’èñ’°ø’»Û’Ã³'
back = '0.’ÊÖ’²ó'

header = ['ning', 'peng', 'zhao', 'cai']
names = ['”ºÇ™«â','’×Å’±í’²Å','‘ÕÔ’¹¨’À¯','’èñ’½Õ’àñ']

ning_debt = {'ning':0., 'peng':0., 'zhao':0., 'cai':0.}

peng_debt = {'ning':0., 'peng':0., 'zhao':0., 'cai':0.}

zhao_debt = {'ning':0., 'peng':0., 'zhao':0., 'cai':0.}

cai_debt = {'ning':0., 'peng':0., 'zhao':0., 'cai':0.}

debts = [ning_debt, peng_debt, zhao_debt, cai_debt]

# Record the performance history

history = open("history.dat", "a", encoding='utf-8')

history.write(time.asctime(time.localtime(time.time())))
history.write('\n')

# Function for adding record

def add(d = debts, h = history):
    while True:
        print('\n(œò¡ğœò¡¹œò¢Áœò¡¹œò¡ğ)--- ‘Õâ’¼¡’À§‘Ë­’ÉÕ’Åª‘Ç®’¡©\n', options, back)
        payer = input('\nœôÖ¹(œô÷Àœôó¸œô÷¼œôóµœôóµ)œôÖ·---- ')
        try:
            name_index = int(payer)
        except ValueError:
            print('(“´«_“´«)---- ”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
            continue
        if name_index == 0:
            break
        if name_index < 0 or name_index > 4:
            print('œô§£( œò¤¦œôÁ§œò¤¦)---- ”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
            continue

        print('\nœôÃĞ·°(œô·ùœô¤ãœô¥õœóğïœô¤âœô¥õœô·ù)°·œôÃĞ-- ’ÂØ‘Ë­’ÉÕ’Åª‘Ç®’¡©\n’¡Ê’¼ã’À§’Â¿’Ğ¤’¿Í‘Ôò’ÍÑ’±Ñ’Ê¸’¿à’¹æ’Ê¬’³Ö’¡¤’Èæ’Ç¡ 1,4 ’°Õ’»×’À§’Í­’¿Í’¡Ë\n\n', options)
        payee = input('\n’¡¼( ´ œò¡ı ` )‰É---- ')
        if payee.find('’¡¤') != -1:
            print('( œôó¢oœôó¢) ---- ‘Çë’ÍÑ’±Ñ’Ê¸’¿à’¹æ’¡¤‘Ë§’Ó§’¡ª\n')
            continue

        string_list = payee.split(',')
        try:
            int_set = {int(i) for i in string_list if int(i) >= 0 and int(i) <=4}
        except ValueError:
            print('œôô­œôô­ œò¢¿€ô¨£œóõ½ê²° œôó¾œôìåœô¨Ôœô¥È œôó¾œôìä œò¡¬€ô¨£œóõ½ê²±-- ”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
            continue

        try:
            total_amount = float(input('\n( ´œô¦¨ œôëÕ `œô¦¨ )œò¢¾œò£á--- ’ÉÕ’Î»’Â¿’¾¯‘Ç®’¡©\n\nœò ¡œô§£(‰ßœô¨´‰ß|||)œò ¡---- '))
        except ValueError:
            print('o(’¡·œò¡ı’¡·)o-- ”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
            continue

        average = amount/len(int_set)
        for n in int_set:
            d[name_index-1][header[n-1]] += average
            hist = '{}’ÂØ{}’ÉÕ’Î»{}‘°÷\n'.format(names[name_index-1],names[n-1],average)
            h.write(hist)
            continue

# Function to check record

def calculate(d = debts, h = history):
    while True:
        print('œôÂå(œôÃÑ œô¥À“¤µ œô¥ÁœôÃÑ)œôÂå---- ”°ß’À§‘Ë­’¡©\n', options, back)
        try:
            richman = int(input('\nœô¤µœôó¢œô¥Àœô§Éœôó¢œô¥Áœô¤´œò¥ç---- '))
        except ValueError:
            print('œôô­œô¤ä·œô¦¨œôÅİ·œô¦¨œô¤äœôô®œôÂåœô¤òœô¤ò---- ”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
            continue
        if richman == 0:
            break

        cal = {'”ºÇ’ºÓ’¿Ã':0.,'’×Å’Ğ²’Úç':0.,'‘ÕÔ’Ëô’Äî':0.,'’èñ’¹¯’±Ê':0.}
        print(' œô¤ûœô¤û€ô¨£œóõ½ê©¢ œô¿í(œô¥µ¯œô¥ôœô¦²€ô¨£œóõ½ê§´¯œô¥ôœô¦²œô¥µ)œô¾Èœôòı-- ”°ß’Ê¬‘±ğ’·ç')
        j = 0
        for c in cal.keys():
            cal[c] = debts[j][header[richman-1]] - debts[richman-1][header[j]]
            j += 1
        for name, money in cal.items():
            print('œôÂå^œôó¢œóò¬œôó¢^œôÂå----{} {}'.format(name, money))
        print('~(  ~³œô§É³ )~œò¢í-------------- Pounds\n')

        h.write(names[richman-1])
        h.write('˜³è‘ÕÊ\n')
        continue

# Function to reset record

def clear(d = debts, h = history):
    y = input('€ô¨£œóõ½ê²°œò¢¯€ô¨£œóõ½ê²¡ œô¥ë €ô¨£œóõ½ê²¡œò¢¯€ô¨£œóõ½ê²±---- ”°ß”Ïì’Äê’Í×’À¶’Îí‘Âğ’¡©(y/n) ---- ')
    if y != 'y':
        print('€ô¨£œóõ½ê²°(@’¡®€ô¨£œóõ½ê²³´)€ô¨£œóõ½ê²± ---- ’Æá’½¢’ÉÔ’À¶’Îí’Î»”¢·')
        h.write('’¼è’¾Ã’À¶’Îí\n')
        return

    for i in range(0,4):
        d[i] = d[i].fromkeys(d[i],0.)
    print('\n€ô¨£œóõ½ê²°œò¢¯€ô¨£œóõ½ê²¡ œô¥ë €ô¨£œóõ½ê²¡œò¢¯€ô¨£œóõ½ê²±---- ’À¶’Îí’À®’¸ù’¡ª')
    h.write('’À®’¸ù’À¶’Îí\n')


# Read data file

readFile = open("data.csv", "r")

debt_reader = csv.DictReader(readFile)

count = 0
for row in debt_reader:
    for name in header:
        debts[count][name] = float(row[name])
    count += 1

readFile.close()


# Run the system 

while True:
    print('\n(œôÃÑ¯œò¢Á¯œôÃÑ)-------œò¥çœô»ç(œôÃÑ=œô¥ôœô¥Àœôúä=œô¥ôœô¥ÁœôÃÑ)œôºÍœò¥ç\n')
    print('œô§µ-(=’¡®œô§É´=)-- ‘»¶’·Ş’Íè’Åşœôòü’Ù²”°ß’»»‘ÕËœôòı’·Ï‘Í³\n')
    print('( €ô¨£œóõ½ê²ªœôúó€ô¨£œóõ½ê²ª)---- ”°ß’ÁÛ’´³’½º˜¦¾’¡©\n')
    print('œôÖÆ(‰¥“¤²‰¥)œôÖÄ---- 1.‘¼Ç‘ÕË\nœôÖÆ(‰¥“¤²‰¥)œôÖÄ---- 2.˜³è‘ÕË\nœôÖÆ(‰¥“¤²‰¥)œôÖÄ---- 70.’À¶’Îí\nœôÖÆ(‰¥“¤²‰¥)œôÖÄ---- 0.’Êİ’Â¸’Öõ’Âà’½Ğ')
    print('\nœò¥ç(œôø·œôù§€ô¨£œóõ½ê§´œôù¦)’¿Í(œôù§€ô¨£œóõ½ê¨ªœôù¦œôø·)œò¥ç\n')
    try:
        alt = int(input('(œô¤êoœô¥ôœô¥öœô¥÷œô¥äœôúäoœô¥ôœô¥öœô¥÷œô¥äœô¤ë)---- '))
    except ValueError:
        print('’¡³(’£ï`’»®œôó²’£ï)‰É”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª\n')
        continue
    if alt != 1 and alt != 2 and alt != 0 and alt != 70:
        print('”°ß’ÉÔ’Í×’Íğ‘Êä’Æş’¡¤‘Ë§’Ó§’¡ª’¡³(’£ï`’»®œôó²’£ï)‰É\n')
        continue

    if alt == 1:
        add()
    elif alt == 2:
        calculate()
    elif alt == 70:
        clear()
    else:
        break

# Save data file

writeFile = open("data.csv", "w")

debt_writer = csv.DictWriter(writeFile, header)

debt_writer.writeheader()

for debt in debts:
     debt_writer.writerow(debt)

writeFile.close()

history.close()